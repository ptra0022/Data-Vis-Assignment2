{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 500,
  "title": {
    "text": "Alcohol-Induced Death Rates in Australia by State, 2020â€“2023",
    "fontSize": 16,
    "anchor": "middle"
  },
  "config": { "view": { "stroke": null } },

  "params": [
    {
      "name": "yearParam",
      "value": 2023,
      "bind": { "input": "select", "options": [2020, 2021, 2022, 2023], "name": "Year: " }
    }
  ],

  "data": {
    "url": "data/aus_states_simplified.topo.json",
    "format": { "type": "topojson", "feature": "au" }
  },

  "transform": [
    { "calculate": "datum.properties.id", "as": "topo_id" },
    {
      "lookup": "topo_id",
      "from": {
        "data": { "url": "data/state_topo_crosswalk.csv" },
        "key": "topo_id",
        "fields": ["state_code"]
      }
    },
    { "calculate": "datum.state_code + '-' + toString(yearParam)", "as": "join_key" },
    {
      "lookup": "join_key",
      "from": {
        "data": { "url": "data/alcohol_state_rates_keys.csv" },
        "key": "join_key",
        "fields": ["year", "deaths", "erp", "rate_per_100k"]
      }
    }
  ],

  "projection": { "type": "identity", "reflectY": true },

  "mark": { "type": "geoshape", "stroke": "#f0f0f0", "strokeWidth": 1 },

  "encoding": {
    "color": {
      "field": "rate_per_100k",
      "type": "quantitative",
      "title": "Deaths per 100,000",
      "scale": { "scheme": "reds", "domain": [0, 10] },
      "legend": {
        "orient": "bottom",
        "title": "Rate per 100k",
        "gradientLength": 200
      }
    },
    "tooltip": [
      { "field": "properties.name", "title": "State/Territory" },
      { "field": "year", "title": "Year" },
      { "field": "deaths", "title": "Deaths", "type": "quantitative", "format": "," },
      { "field": "rate_per_100k", "title": "Rate per 100k", "type": "quantitative", "format": ".2f" }
    ]
  }
}
